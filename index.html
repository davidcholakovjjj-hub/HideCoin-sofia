Copilot Chat
Make HIDECOIN Sofia app fully functional
You said: <!DOCTYPE html> <html lang="en"> <head> <meta
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü™ô HIDECOIN Sofia</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#fff}.navbar{background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.2);padding:20px 30px;position:sticky;top:0;z-index:1000;display:flex;justify-content:space-between;align-items:center;box-shadow:0 8px 32px rgba(0,0,0,0.1)}.navbar-brand{display:flex;align-items:center;gap:12px;font-size:1.8rem;font-weight:800;color:#fff;text-shadow:0 2px 10px rgba(0,0,0,0.3)}.navbar-brand i{font-size:2rem;animation:spin 3s linear infinite}@keyframes spin{0%,100%{transform:rotate(0deg)}50%{transform:rotate(180deg)}}.navbar-menu{display:flex;gap:8px;flex-wrap:wrap}.nav-link{color:#fff;text-decoration:none;font-weight:600;padding:10px 20px;border-radius:12px;transition:all 0.3s;font-size:0.95rem;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2)}.nav-link:hover,.nav-link.active{background:rgba(255,255,255,0.3);transform:translateY(-2px);box-shadow:0 4px 15px rgba(0,0,0,0.2)}.btn{padding:12px 24px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;font-size:1rem;box-shadow:0 4px 15px rgba(0,0,0,0.2)}.btn-primary{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(245,87,108,0.4)}.btn-success{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff}.btn-success:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(79,172,254,0.4)}.container{max-width:1200px;margin:0 auto;padding:30px 20px}.card{background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);border-radius:24px;padding:30px;border:1px solid rgba(255,255,255,0.3);margin:20px 0;box-shadow:0 8px 32px rgba(0,0,0,0.1);animation:fadeIn 0.5s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.card h2{font-size:2rem;margin-bottom:15px;color:#fff;text-shadow:0 2px 10px rgba(0,0,0,0.2)}.card h3{font-size:1.5rem;margin:20px 0 10px;color:#fff}.tab-content{display:none}.tab-content.active{display:block}#map-container,.location-picker{height:450px;width:100%;border-radius:20px;border:3px solid rgba(255,255,255,0.3);margin:20px 0;box-shadow:0 8px 32px rgba(0,0,0,0.2)}.location-picker{height:250px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#fff;font-size:1.05rem}.form-control{width:100%;padding:14px 18px;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);border-radius:12px;color:#fff;font-size:1rem;transition:all 0.3s;font-family:'Poppins',sans-serif}.form-control::placeholder{color:rgba(255,255,255,0.6)}.form-control:focus{outline:none;background:rgba(255,255,255,0.25);border-color:rgba(255,255,255,0.5);box-shadow:0 0 20px rgba(255,255,255,0.2)}.d-none{display:none!important}.text-center{text-align:center}.mt-20{margin-top:20px}.mt-10{margin-top:10px}.w-100{width:100%}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);z-index:2000;justify-content:center;align-items:center;animation:fadeIn 0.3s}.modal-content{background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);padding:40px;border-radius:24px;max-width:420px;width:90%;border:1px solid rgba(255,255,255,0.3);box-shadow:0 8px 32px rgba(0,0,0,0.3);animation:slideUp 0.4s}@keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-content h3{color:#fff;margin-bottom:25px;font-size:1.8rem}.badge{display:inline-block;padding:8px 16px;border-radius:20px;font-size:0.85rem;font-weight:700;box-shadow:0 2px 10px rgba(0,0,0,0.2)}.badge-hider{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%)}.badge-finder{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)}.message{position:fixed;top:20px;right:20px;padding:16px 28px;color:#fff;border-radius:12px;z-index:3000;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,0.3);animation:slideIn 0.3s}@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}.coin-grid,.profiles-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:20px}.coin-card,.profile-card{background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);border-radius:20px;padding:25px;border:1px solid rgba(255,255,255,0.3);transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.1)}.coin-card:hover{transform:translateY(-8px);box-shadow:0 12px 40px rgba(0,0,0,0.2)}.coin-card h3{color:#fff;margin-bottom:12px;font-size:1.3rem}.coin-card p{color:rgba(255,255,255,0.9);margin-bottom:15px;line-height:1.6}.coin-card button{width:100%;margin-top:15px;font-weight:700;border:none}.profile-card{text-align:center}.profile-card h4{color:#fff;margin-bottom:10px;font-size:1.4rem}.profile-stats{font-size:1rem;color:rgba(255,255,255,0.9);margin-top:8px}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:20px}.stat-card{background:rgba(255,255,255,0.2);backdrop-filter:blur(20px);padding:25px;border-radius:16px;border:1px solid rgba(255,255,255,0.3);text-align:center;transition:all 0.3s}.stat-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.2)}.stat-card .number{font-size:2.5rem;font-weight:800;color:#fff;display:block;margin:10px 0}.stat-card .label{font-size:1rem;color:rgba(255,255,255,0.9);font-weight:600}.user-badge{background:rgba(255,255,255,0.2);backdrop-filter:blur(20px);padding:20px;border-radius:16px;border:1px solid rgba(255,255,255,0.3);margin-top:20px}.rarity-badge{display:inline-block;padding:6px 14px;border-radius:20px;font-size:0.85rem;font-weight:700;margin-top:10px;box-shadow:0 2px 10px rgba(0,0,0,0.2)}.btn-group{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap}.instructions{background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);padding:20px;border-radius:16px;border:1px solid rgba(255,255,255,0.2);margin-top:20px}.instructions h4{color:#fff;margin-bottom:15px;font-size:1.2rem}.instructions p{color:rgba(255,255,255,0.9);margin-bottom:8px;padding-left:10px;line-height:1.8}select.form-control{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffffff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 15px center;padding-right:40px}@media(max-width:768px){.navbar{padding:15px 20px}.navbar-brand{font-size:1.4rem}.card{padding:20px}.coin-grid,.profiles-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand"><i class="fas fa-coins"></i><span>HIDECOIN Sofia</span></div>
        <div class="navbar-menu">
            <a href="#" class="nav-link active" data-tab="home"><i class="fas fa-home"></i> Home</a>
            <a href="#" class="nav-link" data-tab="map"><i class="fas fa-map"></i> Map</a>
            <a href="#" class="nav-link" data-tab="hide"><i class="fas fa-plus-circle"></i> Hide</a>
            <a href="#" class="nav-link" data-tab="find"><i class="fas fa-search"></i> Find</a>
            <a href="#" class="nav-link" data-tab="profiles"><i class="fas fa-trophy"></i> Profiles</a>
        </div>
        <button class="btn btn-primary" id="auth-btn"><i class="fas fa-user"></i> Login</button>
    </nav>

    <div class="container">
        <div id="home" class="tab-content active">
            <div class="card">
                <h2>üéÆ Welcome to HIDECOIN Sofia</h2>
                <p style="font-size:1.1rem;color:rgba(255,255,255,0.9);margin-bottom:20px">The ultimate treasure hunt game in Sofia, Bulgaria!</p>
                <div id="user-info" class="d-none">
                    <div class="user-badge">
                        <div class="badge" id="user-role-badge">Guest</div>
                        <p style="margin-top:10px;font-size:1.1rem" id="user-name"></p>
                        <button class="btn btn-primary mt-10" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><i class="fas fa-coins" style="font-size:2rem;color:#ffd700"></i><span class="number" id="total-coins">0</span><span class="label">Total Coins</span></div>
                    <div class="stat-card"><i class="fas fa-check-circle" style="font-size:2rem;color:#4facfe"></i><span class="number" id="found-coins">0</span><span class="label">Coins Found</span></div>
                    <div class="stat-card"><i class="fas fa-star" style="font-size:2rem;color:#f5576c"></i><span class="number" id="my-found-coins">0</span><span class="label">Your Finds</span></div>
                </div>
                <div class="instructions">
                    <h4><i class="fas fa-gamepad"></i> How to Play</h4>
                    <p><strong>1.</strong> Click "Login" to start playing</p>
                    <p><strong>2.</strong> Hider password: <code style="background:rgba(255,255,255,0.2);padding:4px 8px;border-radius:6px">heheheha never gonna know</code></p>
                    <p><strong>3.</strong> Hide coins with pictures or find them on the map!</p>
                </div>
            </div>
        </div>

        <div id="map" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-map-marked-alt"></i> Live Coin Map</h2>
                <div id="map-container"></div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="refresh-map-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    <button class="btn btn-success" id="my-location-btn"><i class="fas fa-location-crosshairs"></i> My Location</button>
                </div>
            </div>
        </div>

        <div id="hide" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-gem"></i> Hide a Coin</h2>
                <form id="hide-coin-form">
                    <div class="form-group"><label><i class="fas fa-tag"></i> Coin Title</label><input type="text" class="form-control" id="coin-title" placeholder="Enter coin name" required></div>
                    <div class="form-group"><label><i class="fas fa-align-left"></i> Description</label><textarea class="form-control" id="coin-desc" placeholder="Describe your coin" rows="3" required></textarea></div>
                    <div class="form-group"><label><i class="fas fa-layer-group"></i> Rarity</label><select class="form-control" id="coin-rarity"><option value="common">‚ö™ Common</option><option value="rare">üîµ Rare</option><option value="epic">üü£ Epic</option><option value="legendary">üü° Legendary</option></select></div>
                    <div class="form-group"><label><i class="fas fa-map-pin"></i> Select Location</label><div id="location-picker" class="location-picker"></div><input type="text" class="form-control mt-10" id="coin-location-text" readonly></div>
                    <button type="submit" class="btn btn-primary w-100" style="padding:16px;font-size:1.1rem"><i class="fas fa-cloud-upload-alt"></i> Hide Coin</button>
                </form>
            </div>
        </div>

        <div id="find" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-search-location"></i> Find Coins</h2>
                <div id="coin-grid" class="coin-grid"></div>
            </div>
        </div>

        <div id="profiles" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-trophy"></i> Top Players</h2>
                <div id="profiles-list" class="profiles-grid"></div>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h3>üéÆ Join the Hunt</h3>
            <div class="form-group"><label>Your Name</label><input type="text" class="form-control" id="auth-username" placeholder="Enter your name" required></div>
            <div class="form-group">
                <button class="btn btn-success w-100" id="login-btn"><i class="fas fa-search"></i> Play as Finder</button>
                <button class="btn btn-primary w-100 mt-10" id="hider-login-btn"><i class="fas fa-gem"></i> Login as Hider</button>
                <button class="btn w-100 mt-10" style="background:rgba(255,255,255,0.2);color:#fff" id="guest-btn"><i class="fas fa-eye"></i> Guest</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const app=firebase.initializeApp({apiKey:"AIzaSyAiF_EIhTkbkik4U1Y7T9nM0qIZCYDPLw4",authDomain:"hidecoin-sofia-public.firebaseapp.com",databaseURL:"https://hidecoin-sofia-public-default-rtdb.europe-west1.firebasedatabase.app",projectId:"hidecoin-sofia-public",storageBucket:"hidecoin-sofia-public.appspot.com",messagingSenderId:"756894260998",appId:"1:756894260998:web:da7b06d6b857273d0dac8c"});
        const db=firebase.database();
        let user=null,role='guest',map=null,locMap=null,lat=42.6977,lng=23.3219,coins=[],markers=[];

        function msg(t,c){
            const m=document.createElement('div');
            m.className='message';
            m.textContent=t;
            m.style.background=c=='success'?'linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)':c=='error'?'linear-gradient(135deg,#f093fb 0%,#f5576c 100%)':'linear-gradient(135deg,#667eea 0%,#764ba2 100%)';
            document.body.appendChild(m);
            setTimeout(()=>m.remove(),3000);
        }

        function updateUI(){
            const b=document.getElementById('auth-btn');
            const i=document.getElementById('user-info');
            const rb=document.getElementById('user-role-badge');
            const n=document.getElementById('user-name');
            if(user){
                b.innerHTML='<i class="fas fa-user-circle"></i> '+user.displayName;
                i.classList.remove('d-none');
                n.textContent='Logged in as: '+user.displayName;
                rb.textContent=role=='hider'?'üé® Hider':'üîç Finder';
                rb.className='badge '+(role=='hider'?'badge-hider':'badge-finder');
            }else{
                b.innerHTML='<i class="fas fa-user"></i> Login';
                i.classList.add('d-none');
            }
        }

        function loadCoins(){
            db.ref('coins').once('value').then(s=>{
                coins=[];
                const d=s.val();
                if(d)Object.keys(d).forEach(k=>coins.push({id:k,...d[k]}));
                updateStats();
                updateGrid();
                if(map)updateMap();
            }).catch(e=>console.error('Load error:',e));
        }

        function updateStats(){
            document.getElementById('total-coins').textContent=coins.length;
            document.getElementById('found-coins').textContent=coins.filter(c=>c.found).length;
            document.getElementById('my-found-coins').textContent=user?coins.filter(c=>c.found&&c.foundBy==user.displayName).length:'0';
        }

        function updateGrid(){
            const g=document.getElementById('coin-grid');
            const av=coins.filter(c=>!c.found);
            if(!av.length){
                g.innerHTML='<p style="text-align:center;color:rgba(255,255,255,0.8);grid-column:1/-1;font-size:1.1rem">No coins available!</p>';
                return;
            }
            g.innerHTML='';
            av.forEach(c=>{
                const colors={common:'linear-gradient(135deg,#84fab0 0%,#8fd3f4 100%)',rare:'linear-gradient(135deg,#a8edea 0%,#fed6e3 100%)',epic:'linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%)',legendary:'linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%)'};
                const cd=document.createElement('div');
                cd.className='coin-card';
                cd.innerHTML=`<h3>üí∞ ${c.title}</h3><p>${c.description}</p><div class="rarity-badge" style="background:${colors[c.rarity]};color:#333">${c.rarity.toUpperCase()}</div><p style="color:rgba(255,255,255,0.7);margin-top:12px;font-size:0.9rem"><i class="fas fa-user-secret"></i> ${c.hiddenBy}</p><button onclick="findCoin('${c.id}')" class="btn btn-success"><i class="fas fa-search"></i> Find</button>`;
                g.appendChild(cd);
            });
        }

        function updateProfiles(){
            db.ref('players').once('value').then(s=>{
                const pl=document.getElementById('profiles-list');
                const players={};
                const d=s.val();
                if(d)Object.keys(d).forEach(k=>players[k]=d[k]);
                coins.forEach(c=>{
                    if(c.found&&c.foundBy&&c.foundBy!='Guest'){
                        const n=c.foundBy.replace(/[.#$/[\]]/g,'_');
                        if(!players[n])players[n]={name:c.foundBy,coinsFound:0};
                        players[n].coinsFound=(players[n].coinsFound||0)+1;
                    }
                });
                const arr=Object.values(players).sort((a,b)=>(b.coinsFound||0)-(a.coinsFound||0));
                if(!arr.length){
                    pl.innerHTML='<p style="text-align:center;color:rgba(255,255,255,0.8);grid-column:1/-1">No players yet!</p>';
                    return;
                }
                pl.innerHTML='';
                arr.forEach((p,i)=>{
                    const medals=['ü•á','ü•à','ü•â'];
                    const pc=document.createElement('div');
                    pc.className='profile-card';
                    pc.innerHTML=`<div style="font-size:3rem;margin-bottom:10px">${medals[i]||'üèÜ'}</div><h4>${p.name}</h4><div class="profile-stats"><strong>${p.coinsFound||0}</strong> coins</div>`;
                    pl.appendChild(pc);
                });
            }).catch(e=>console.error('Profiles error:',e));
        }

        function initMap(){
            const c=document.getElementById('map-container');
            if(!c)return;
            if(map){map.remove();markers=[]}
            map=L.map('map-container').setView([42.6977,23.3219],13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            updateMap();
        }

        function updateMap(){
            if(!map)return;
            markers.forEach(m=>{if(map&&m)map.removeLayer(m)});
            markers=[];
            coins.forEach(c=>{
                if(!c.found){
                    const colors={common:'#84fab0',rare:'#a8edea',epic:'#ff9a9e',legendary:'#ffecd2'};
                    const ic=L.divIcon({html:`<div style="background:${colors[c.rarity]};width:35px;height:35px;border-radius:50%;border:3px solid white;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(0,0,0,0.3)"><div style="font-size:1.2rem">üí∞</div></div>`,iconSize:[35,35]});
                    const m=L.marker([c.lat,c.lng],{icon:ic}).addTo(map);
                    m.bindPopup(`<div style="color:#333;min-width:220px;background:#fff;padding:18px;border-radius:12px;font-family:'Poppins',sans-serif"><h3 style="color:#667eea;margin-bottom:10px">${c.title}</h3><p style="color:#666;margin-bottom:12px">${c.description}</p><div style="background:${colors[c.rarity]};color:#333;padding:4px 12px;border-radius:20px;display:inline-block;font-size:0.85rem;font-weight:700;margin:8px 0">${c.rarity.toUpperCase()}</div><p style="color:#999;font-size:0.9rem;margin-top:10px">By ${c.hiddenBy}</p><button onclick="findCoin('${c.id}')" style="background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;width:100%;margin-top:12px;font-weight:700">Find</button></div>`);
                    markers.push(m);
                }
            });
        }

        function initLocPicker(){
            if(locMap)locMap.remove();
            locMap=L.map('location-picker').setView([42.6977,23.3219],14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(locMap);
            const m=L.marker([42.6977,23.3219],{draggable:true}).addTo(locMap);
            m.on('dragend',()=>{lat=m.getLatLng().lat;lng=m.getLatLng().lng;updateLocTxt()});
            locMap.on('click',e=>{m.setLatLng(e.latlng);lat=e.latlng.lat;lng=e.latlng.lng;updateLocTxt()});
            updateLocTxt();
        }

        function updateLocTxt(){
            const t=document.getElementById('coin-location-text');
            if(t)t.value=`üìç Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
        }

        function loginUser(r){
            const n=document.getElementById('auth-username').value.trim();
            if(!n){msg('Enter your name','error');return}
            user={uid:'u_'+Date.now(),displayName:n};
            role=r;
            updateUI();
            document.getElementById('auth-modal').style.display='none';
            msg('Welcome '+n+'! üéâ','success');
            document.getElementById('auth-username').value='';
        }

        async function hideCoin(){
            if(role!='hider'){msg('Need hider access!','error');document.getElementById('auth-modal').style.display='flex';return}
            const t=document.getElementById('coin-title').value;
            const d=document.getElementById('coin-desc').value;
            const r=document.getElementById('coin-rarity').value;
            if(!t||!d){msg('Fill all fields','error');return}
            try{
                const nc={title:t,description:d,rarity:r,lat:lat,lng:lng,hiddenBy:user.displayName,found:false,createdAt:new Date().toISOString()};
                await db.ref('coins').push(nc);
                document.getElementById('hide-coin-form').reset();
                updateLocTxt();
                msg('Coin hidden! üíé','success');
                setTimeout(()=>{loadCoins();document.querySelector('.nav-link[data-tab="map"]').click()},1000);
            }catch(e){msg('Error: '+e.message,'error')}
        }

        window.findCoin=function(id){
            if(!user){msg('Login first!','error');document.getElementById('auth-modal').style.display='flex';return}
            const c=coins.find(x=>x.id==id);
            if(!c||c.found){msg('Not available','error');return}
            db.ref('coins/'+id).update({found:true,foundBy:user.displayName,foundAt:new Date().toISOString()}).then(()=>{
                msg('Found '+c.title+'! üéâ','success');
                loadCoins();
                updateProfiles();
            }).catch(e=>msg('Error: '+e.message,'error'))
        }

        document.querySelectorAll('.nav-link').forEach(l=>{
            l.addEventListener('click',e=>{
                e.preventDefault();
                const tab=l.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active'));
                document.getElementById(tab).classList.add('active');
                l.classList.add('active');
                if(tab=='map')initMap();
                if(tab=='hide'&&!locMap)initLocPicker();
                if(tab=='find')loadCoins();
                if(tab=='profiles')updateProfiles();
            });
        });

        document.getElementById('auth-btn').addEventListener('click',()=>{
            if(user)return;
            document.getElementById('auth-modal').style.display='flex';
        });

        document.getElementById('login-btn').addEventListener('click',()=>loginUser('finder'));
        
        document.getElementById('hider-login-btn').addEventListener('click',()=>{
            const pwd=prompt('Enter hider password:');
            if(pwd=='hider123')loginUser('hider');
            else msg('Wrong password!','error');
        });

        document.getElementById('guest-btn').addEventListener('click',()=>{
            user={uid:'guest',displayName:'Guest'};
            role='guest';
            updateUI();
            document.getElementById('auth-modal').style.display='none';
            msg('Welcome Guest! üëã','success');
        });

        document.getElementById('logout-btn').addEventListener('click',()=>{
            user=null;
            role='guest';
            updateUI();
            msg('Logged out','info');
        });

        document.getElementById('hide-coin-form').addEventListener('submit',e=>{
            e.preventDefault();
            hideCoin();
        });

        document.getElementById('refresh-map-btn').addEventListener('click',()=>{
            loadCoins();
            msg('Map refreshed!','success');
        });

        document.getElementById('my-location-btn').addEventListener('click',()=>{
            if(!navigator.geolocation){msg('Geolocation not supported','error');return}
            navigator.geolocation.getCurrentPosition(pos=>{
                if(map){
                    map.setView([pos.coords.latitude,pos.coords.longitude],15);
                    L.marker([pos.coords.latitude,pos.coords.longitude]).addTo(map).bindPopup('You are here!').openPopup();
                    msg('Location found!','success');
                }
            },()=>msg('Could not get location','error'));
        });

        loadCoins();
        setInterval(loadCoins,30000);
    </script>
</body>
</html>
